
> storycraft@0.1.0 dev
> next dev

  â–² Next.js 14.2.31
  - Local:        http://localhost:3000
  - Environments: .env

 âœ“ Starting...
 âœ“ Ready in 4.3s
 â—‹ Compiling / ...
 âœ“ Compiled / in 3.2s (2257 modules)
Component rendered
 GET / 200 in 3654ms
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /favicon.ico in 1520ms (2269 modules)
 GET /favicon.ico 200 in 737ms
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 1334ms
 GET /favicon.ico 200 in 21ms
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Initializing Gemini Service with config: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  model: 'gemini-2.5-flash',
  timeout: 60000
}
Vertex AI client initialized successfully
Attempting transcript extraction for video: snyvim1b4aw
Checking transcript availability for video: snyvim1b4aw
Found 1 caption track(s) available
Best caption track: zh-TW (standard)
Attempting caption download (likely to fail due to OAuth requirement)
Caption download requires OAuth 2.0 authentication (expected failure)
Caption content download failed (OAuth required) - this is expected behavior
No usable transcript content available for this video
Transcript not available, extracting enhanced metadata...
Extracting enhanced metadata for video: snyvim1b4aw
Enhanced metadata extraction failed: TypeError: fetch failed
    at node:internal/deps/undici/undici:13510:13
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async extractVideoInsightsFromMetadata (webpack-internal:///(action-browser)/./lib/youtube-transcript.ts:192:26)
    at async _lib_performance_monitor__WEBPACK_IMPORTED_MODULE_5__.performanceMonitor.trackOperation.url.url (webpack-internal:///(action-browser)/./app/actions/process-reference.ts:95:38)
    at async PerformanceMonitor.trackOperation (webpack-internal:///(action-browser)/./lib/performance-monitor.ts:22:28)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) {
  [cause]: Error: read ECONNRESET
      at TLSWrap.onStreamRead (node:internal/stream_base_commons:218:20)
      at TLSWrap.callbackTrampoline (node:internal/async_hooks:130:17) {
    errno: -54,
    code: 'ECONNRESET',
    syscall: 'read'
  }
}
 POST / 200 in 667ms
Processing reference content with enhanced Gemini service
Source type: youtube
Has transcript: false
Description length: 433
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 1784ms with: HEALTHY
Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 1785
}
Using enhanced description content
Content Complexity Analysis: {
  contentType: 'youtube_medium',
  isShorts: false,
  shortsStyle: undefined,
  topicsComplexity: 'simple',
  tokenAllocation: 3500,
  reasoning: 'Medium YouTube video (60-300s) + No complexity adjustments = 3500 tokens',
  useStructuredOutput: undefined
}
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 3251,
  temperature: 0.3,
  maxTokens: 3500,
  timeout: 60000
}
Attempt 1/3 with model: gemini-2.5-flash
Generated text successfully in 18866ms: {
  textLength: 2265,
  textPreview: '{\n' +
    '  "analysis": {\n' +
    '    "keyTopics": [\n' +
    '      "æ­§è·¯æ—…äºº2",\n' +
    '      "å¿«é€Ÿå‡ç´šæ”»ç•¥",\n' +
    '      "å¾ŒæœŸéŠæˆ²ç­–ç•¥",\n' +
    '      "è§’è‰²æ‰®æ¼”éŠæˆ²æ©Ÿåˆ¶"...'
}
ðŸ”§ Starting enhanced JSON parsing for AI response
Raw AI response length: 2265
First 200 chars: {
  "analysis": {
    "keyTopics": [
      "æ­§è·¯æ—…äºº2",
      "å¿«é€Ÿå‡ç´šæ”»ç•¥",
      "å¾ŒæœŸéŠæˆ²ç­–ç•¥",
      "è§’è‰²æ‰®æ¼”éŠæˆ²æ©Ÿåˆ¶",
      "HD-2Dè¦–è¦ºé¢¨æ ¼"
    ],
    "sentiment": "positive",
    "coreMessage": "æä¾›ã€Šæ­§è·¯æ—…äºº2ã€‹çŽ©å®¶ä¸€å¥—é«˜æ•ˆçš„å¾ŒæœŸå‡ç´šç­–ç•¥ï¼Œå¹«
âœ… Enhanced JSON parsing successful!
Repair attempts: 2
Parse time: 3ms
Content processing completed in 20670ms
 POST / 200 in 20691ms
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
ðŸ” Debug tracking started for: generate-scenes
ðŸ“ Starting step: initialization
ðŸŽ¬ Generating scenes with enhanced Gemini service
ðŸŒ Environment Information:
  Project ID: fechen-aifactory
  Location: us-central1
  Gemini Model: NOT SET
  Veo Model: veo-001
  Node Environment: development
  GCS Storage URI: NOT SET
  YouTube API Key: SET
âš ï¸ Environment warnings: [
  'GEMINI_MODEL is not set - will use default gemini-1.5-pro-002',
  'GCS_VIDEOS_STORAGE_URI is not set - video generation may fail'
]
ðŸ“Š Configuration: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  geminiModel: 'gemini-pro',
  pitchLength: 1667,
  numScenes: 8,
  style: 'Live-Action',
  language: 'ç¹é«”ä¸­æ–‡'
}
âœ… Completed step: initialization (0ms)
ðŸ“ Starting step: health-check
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 1520ms with: HEALTHY
ðŸ¥ Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 1521
}
âœ… Completed step: health-check (1521ms)
ðŸ“ Starting step: gemini-text-generation
ðŸŽ¯ Creating storyboard with Gemini...
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 6005,
  temperature: 1,
  maxTokens: 8192,
  timeout: 60000
}
Attempt 1/3 with model: gemini-2.5-flash
Generated text successfully in 27003ms: {
  textLength: 9352,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "ã€å½±ç‰‡æ¨™é¡Œï¼šäººç”ŸLV.99ï¼šä½ çš„å°ˆå±¬ã€Œè‰¾éš†å¾·ã€å‡ç´šæ³•ã€‘\\n\\n**é–‹å ´ï¼š**\\nå½±ç‰‡å¾žä¸€å€‹å£“æŠ‘çš„æ›¸æˆ¿é–‹å§‹ã€‚ç•«é¢ç‰¹å¯«ä¸€ä½å¹´è¼•ã€ç–²æ†Šçš„å¥³æ€§ï¼Œå¥¹çœ‰é ­ç·ŠéŽ–ï¼Œçœ¼ç¥ž...'
}
âœ… Gemini response received: {
  textLength: 9352,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "ã€å½±ç‰‡æ¨™é¡Œï¼šäººç”ŸLV.99ï¼šä½ çš„å°ˆå±¬ã€Œè‰¾éš†å¾·ã€å‡ç´šæ³•ã€‘\\n\\n**é–‹å ´ï¼š**\\nå½±ç‰‡å¾žä¸€å€‹å£“æŠ‘çš„æ›¸æˆ¿é–‹å§‹ã€‚ç•«é¢ç‰¹å¯«ä¸€ä½å¹´è¼•ã€ç–²æ†Šçš„å¥³æ€§ï¼Œå¥¹çœ‰é ­ç·ŠéŽ–ï¼Œçœ¼ç¥žä¸­å……æ»¿äº†æŒ«æ•—æ„Ÿã€‚é¡é ­ç·©ç·©æ‹‰é ï¼Œå‘ˆç¾å‡ºä¸€å€‹é›œäº‚ä¸å ªçš„æ›¸æ¡Œï¼Œä¸Šé¢å †æ»¿äº†å°ˆæ¥­æ›¸ç±ã€æ•£äº‚çš„æ–‡ä»¶å’Œæœªå®Œæˆçš„å°ˆæ¡ˆã€‚å…‰ç·šæ˜æš—ï¼Œåªæœ‰ä¸€ç›žæª¯ç‡ˆå¾®å¼±åœ°ç…§äº®æ¡Œé¢ï¼Œç‡Ÿé€ å‡ºåœæ»¯ä¸å‰çš„æ°›åœã€‚çª—å¤–ï¼Œé™°æ²‰çš„å¤©ç©ºä¸‹è‘—å°é›¨ï¼Œé›¨æ»´è¼•è¼•æ•²æ‰“...'
}
âœ… Completed step: gemini-text-generation (27005ms)
ðŸ“ Starting step: response-parsing
Cleaning JSON response, original length: 9352
Cleaned JSON length: 9322
JSON structure check - braces balanced: true
Failed to parse AI response, raw text: ```json
{
 "scenario": "ã€å½±ç‰‡æ¨™é¡Œï¼šäººç”ŸLV.99ï¼šä½ çš„å°ˆå±¬ã€Œè‰¾éš†å¾·ã€å‡ç´šæ³•ã€‘\n\n**é–‹å ´ï¼š**\nå½±ç‰‡å¾žä¸€å€‹å£“æŠ‘çš„æ›¸æˆ¿é–‹å§‹ã€‚ç•«é¢ç‰¹å¯«ä¸€ä½å¹´è¼•ã€ç–²æ†Šçš„å¥³æ€§ï¼Œå¥¹çœ‰é ­ç·ŠéŽ–ï¼Œçœ¼ç¥žä¸­å……æ»¿äº†æŒ«æ•—æ„Ÿã€‚é¡é ­ç·©ç·©æ‹‰é ï¼Œå‘ˆç¾å‡ºä¸€å€‹é›œäº‚ä¸å ªçš„æ›¸æ¡Œï¼Œä¸Šé¢å †æ»¿äº†å°ˆæ¥­æ›¸ç±ã€æ•£äº‚çš„æ–‡ä»¶å’Œæœªå®Œæˆçš„å°ˆæ¡ˆã€‚å…‰ç·šæ˜æš—ï¼Œåªæœ‰ä¸€ç›žæª¯ç‡ˆå¾®å¼±åœ°ç…§äº®æ¡Œé¢ï¼Œç‡Ÿé€ å‡ºåœæ»¯ä¸å‰çš„æ°›åœã€‚çª—å¤–ï¼Œé™°æ²‰çš„å¤©ç©ºä¸‹è‘—å°é›¨ï¼Œé›¨æ»´è¼•è¼•æ•²æ‰“è‘—çŽ»ç’ƒã€‚\nç•«å¤–éŸ³å‚³ä¾†ä¸€è²æ²‰é‡çš„å˜†æ¯ï¼šã€Œæ€Žéº¼åŠªåŠ›ï¼Œéƒ½æ„Ÿè¦ºåœæ»¯ä¸å‰â€¦ã€\n\n**è§’è‰²ä»‹ç´¹ï¼š**\nä¸»è§’æ˜¯ä¸€ä½ç´„èŽ«äºŒåå¤šæ­²çš„å¥³æ€§ï¼Œè°æ…§ä½†ç›®å‰æ·±é™·å›°å¢ƒã€‚å¥¹ä¸¦éžåœ¨çŽ©éŠæˆ²ï¼Œè€Œæ˜¯åœ¨ç¾å¯¦ç”Ÿæ´»ä¸­é¢è‡¨è‘—å·¨å¤§çš„ã€Œé—œå¡ã€â€”â€”å¯èƒ½æ˜¯å­¸æ¥­ç ”ç©¶çš„ç“¶é ¸ã€è·å ´å°ˆæ¡ˆçš„æŒ‘æˆ°ï¼Œæˆ–æ˜¯å€‹äººæˆé•·çš„è¿·èŒ«ã€‚å¥¹æ¸´æœ›çªç ´ï¼Œé”åˆ°è‡ªå·±äººç”Ÿçš„ã€ŒLV.99ã€ï¼Œä½†å»å§‹çµ‚æ‰¾ä¸åˆ°æ­£ç¢ºçš„æ–¹æ³•ï¼Œæ„Ÿåˆ°å¿ƒåŠ›äº¤ç˜ã€‚\n\n**ç¬¬ä¸€å¹•ï¼šå›°å¢ƒèˆ‡è¿·èŒ« (é–‹ç«¯)**\næ›¸æˆ¿è£¡ï¼Œå¹´è¼•å¥³æ€§é›™æ‰‹æŠ±é ­ï¼Œååœ¨æ›¸æ¡Œå‰ã€‚é›»è…¦èž¢å¹•ä¸Šé¡¯ç¤ºè‘—è¤‡é›œé›£è§£çš„æ•¸æ“šæ¨¡åž‹æˆ–å­¸è¡“è«–æ–‡ï¼Œå¥¹é¡¯ç„¶å·²é™·å…¥åƒµå±€ã€‚å¥¹æ‹¿èµ·ç­†åˆç„¡åŠ›åœ°æ”¾ä¸‹ï¼Œæ¡Œé¢ä¸Šæ•£è½è‘—ç„¡æ•¸å¤±æ•—çš„è‰ç¨¿ï¼Œè±¡å¾µè‘—å¥¹ç„¡åŠ©çš„æŽ™æ‰Žã€‚æ˜æš—é›œäº‚çš„æˆ¿é–“æ˜ ç…§å‡ºå¥¹å…§å¿ƒçš„æ··äº‚èˆ‡åœ
ðŸš¨ Error in response-parsing: Parse error: There was an issue processing the AI response.
Error parsing AI response: Error: Response Processing Error: There was an issue processing the AI response. Please try again.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:225:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
âŒ Completed step: response-parsing (12ms) - Response Processing Error: There was an issue processing the AI response. Please try again.
ðŸš¨ Error in response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
âŒ Error generating scenes: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
ðŸš¨ Error in generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
ðŸ”„ Unexpected error, creating fallback scenario: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
ðŸ”„ Creating fallback scenario due to unexpected error
ðŸ“ Starting step: fallback-scenario
Creating fallback scenario for pitch: ã€å½±ç‰‡æ¨™é¡Œï¼šäººç”ŸLV.99ï¼šä½ çš„å°ˆå±¬ã€Œè‰¾éš†å¾·ã€å‡ç´šæ³•ã€‘
**é–‹å ´é‰¤å­ï¼š**\nç•«é¢å¾žä¸€å€‹ç‰¹å¯«é¡é ­é–‹å§‹ï¼šä¸€å¼µå¹´è¼•ã€ç–²æ†Šçš„è‡‰é¾ï¼Œçœ‰é ­æ·±éŽ–ï¼Œçœ¼ç¥žä¸­å……æ»¿äº†æŒ«æ•—æ„Ÿã€‚é¡é ­ç·©ç·©æ‹‰é ï¼Œå‘ˆç¾å‡ºä¸€å€‹ç•¥é¡¯é›œäº‚çš„æ›¸æˆ¿ï¼Œæ›¸æ¡Œä¸Š
âœ… Completed step: fallback-scenario (1ms)
ðŸ” Debug summary for generate-scenes: {
  totalTime: '28547ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

ðŸ“Š === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 28547ms
Environment: fechen-aifactory/us-central1/not-set

âŒ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

â±ï¸ Step Performance:
  âœ… initialization: 0ms
  âœ… health-check: 1521ms
  âœ… gemini-text-generation: 27005ms
  âŒ response-parsing: 12ms
  âœ… fallback-scenario: 1ms
ðŸ“Š === END SUMMARY ===

ðŸ” Debug summary for generate-scenes: {
  totalTime: '28548ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

ðŸ“Š === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 28548ms
Environment: fechen-aifactory/us-central1/not-set

âŒ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

â±ï¸ Step Performance:
  âœ… initialization: 0ms
  âœ… health-check: 1521ms
  âœ… gemini-text-generation: 27005ms
  âŒ response-parsing: 12ms
  âœ… fallback-scenario: 1ms
ðŸ“Š === END SUMMARY ===

 POST / 200 in 28572ms
Attempting transcript extraction for video: Y7a_ooX7gOM
Checking transcript availability for video: Y7a_ooX7gOM
No captions available for this video
No usable transcript content available for this video
Transcript not available, extracting enhanced metadata...
Extracting enhanced metadata for video: Y7a_ooX7gOM
Enhanced metadata extracted successfully
 POST / 200 in 699ms
Processing reference content with enhanced Gemini service
Source type: youtube
Has transcript: false
Description length: 936
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 719ms with: HEALTHY
Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 719
}
Using enhanced description content
Content Complexity Analysis: {
  contentType: 'youtube_long_form',
  isShorts: false,
  shortsStyle: undefined,
  topicsComplexity: 'moderate',
  tokenAllocation: 5009,
  reasoning: 'Long-form YouTube video (11min) + +500 (moderate complexity) +9 (detailed description) = 5009 tokens',
  useStructuredOutput: undefined
}
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 3692,
  temperature: 0.3,
  maxTokens: 5009,
  timeout: 90000
}
Attempt 1/3 with model: gemini-2.5-flash
Generated text successfully in 23699ms: {
  textLength: 1529,
  textPreview: '{\n' +
    '  "analysis": {\n' +
    '    "keyTopics": [\n' +
    '      "ã€ŠçœŸâ€§ä¸‰åœ‹ç„¡é›™ã€‹25é€±å¹´æ…¶ç¥",\n' +
    '      "ã€ŠçœŸâ€§ä¸‰åœ‹ç„¡é›™ èµ·æºã€‹å¤§åž‹DLC",\n' +
    '      "éŽå¾€ç³»åˆ—ä½œå“...'
}
ðŸ”§ Starting enhanced JSON parsing for AI response
Raw AI response length: 1529
First 200 chars: {
  "analysis": {
    "keyTopics": [
      "ã€ŠçœŸâ€§ä¸‰åœ‹ç„¡é›™ã€‹25é€±å¹´æ…¶ç¥",
      "ã€ŠçœŸâ€§ä¸‰åœ‹ç„¡é›™ èµ·æºã€‹å¤§åž‹DLC",
      "éŽå¾€ç³»åˆ—ä½œå“é«˜ç•«è³ªå¾©åˆ»",
      "è³‡æ·±çŽ©å®¶è¦–è§’åˆ†æžèˆ‡å›žé¡§",
      "å…‰æ¦®æœªä¾†å‹•å‘èˆ‡çŽ©å®¶æœŸå¾…"
    ],
    "sentiment": "positive",
    "coreMessag
âŒ All enhanced parsing strategies failed
Parse errors: [
  'Direct parsing failed: Unterminated string in JSON at position 1529',
  'Basic cleaning schema error: generatedPitch must be a non-empty string'
]
Creating intelligent fallback response...
Content processing completed in 24430ms
 POST / 200 in 24444ms
ðŸŽ¬ Generating scenes from structured pitch
Environment Information:
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: undefined
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Refreshing authentication...
Fetching new access token...
Successfully obtained access token
Gemini API Error: {
  error: {
    code: 400,
    message: 'Please use a valid role: user, model.',
    status: 'INVALID_ARGUMENT'
  }
}
Error calling Gemini directly: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
Error in structured output generation: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
ðŸ”´ ERROR: Error generating structured scenes Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) undefined
 POST / 500 in 648ms
 â¨¯ lib/gemini-direct.ts (58:13) @ generateTextDirect
 â¨¯ Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (./lib/gemini-direct.ts:47:19)
    at async StructuredOutputService.generateCharacters (./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (./app/actions/generate-scenes-structured.ts:33:31)
digest: "2804120234"
[0m [90m 56 |[39m       [36mconst[39m error [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
[0m [90m 57 |[39m       console[33m.[39merror([32m'Gemini API Error:'[39m[33m,[39m error)[33m;[39m[0m
[0m[31m[1m>[22m[39m[90m 58 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Gemini API failed: ${JSON.stringify(error)}`[39m)[33m;[39m[0m
[0m [90m    |[39m             [31m[1m^[22m[39m[0m
[0m [90m 59 |[39m     }[0m
[0m [90m 60 |[39m[0m
[0m [90m 61 |[39m     [36mconst[39m result[33m:[39m [33mGeminiResponse[39m [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
ðŸŽ¬ Generating scenes from structured pitch
Environment Information:
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: undefined
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Using cached access token
Gemini API Error: {
  error: {
    code: 400,
    message: 'Please use a valid role: user, model.',
    status: 'INVALID_ARGUMENT'
  }
}
Error calling Gemini directly: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
Error in structured output generation: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
ðŸ”´ ERROR: Error generating structured scenes Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) undefined
 â¨¯ lib/gemini-direct.ts (58:13) @ generateTextDirect
 â¨¯ Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (./lib/gemini-direct.ts:47:19)
    at async StructuredOutputService.generateCharacters (./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (./app/actions/generate-scenes-structured.ts:33:31)
digest: "2804120234"
[0m [90m 56 |[39m       [36mconst[39m error [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
[0m [90m 57 |[39m       console[33m.[39merror([32m'Gemini API Error:'[39m[33m,[39m error)[33m;[39m[0m
[0m[31m[1m>[22m[39m[90m 58 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Gemini API failed: ${JSON.stringify(error)}`[39m)[33m;[39m[0m
[0m [90m    |[39m             [31m[1m^[22m[39m[0m
[0m [90m 59 |[39m     }[0m
[0m [90m 60 |[39m[0m
[0m [90m 61 |[39m     [36mconst[39m result[33m:[39m [33mGeminiResponse[39m [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
 POST / 500 in 371ms
 âœ“ Compiled in 508ms (1474 modules)
 âœ“ Compiled in 460ms (2234 modules)
   Reload env: .env
 âœ“ Compiled in 137ms (2234 modules)
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
ðŸŽ¬ Generating scenes from structured pitch
Environment Information:
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: undefined
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Refreshing authentication...
Fetching new access token...
Successfully obtained access token
 âœ“ Compiled in 171ms (2234 modules)
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Using cached access token
Error calling Gemini directly: Error: No text generated from Gemini
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:54:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateScenes (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
Error in structured output generation: Error: No text generated from Gemini
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:54:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateScenes (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
ðŸ”´ ERROR: Error generating structured scenes Error: No text generated from Gemini
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:54:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateScenes (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) undefined
 â¨¯ lib/gemini-direct.ts (67:13) @ generateTextDirect
 â¨¯ Error: No text generated from Gemini
    at generateTextDirect (./lib/gemini-direct.ts:54:19)
    at async StructuredOutputService.generateScenes (./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (./app/actions/generate-scenes-structured.ts:33:31)
digest: "406129011"
[0m [90m 65 |[39m       [36mreturn[39m result[33m.[39mcandidates[[35m0[39m][33m.[39mcontent[33m.[39mparts[[35m0[39m][33m.[39mtext[33m;[39m[0m
[0m [90m 66 |[39m     } [36melse[39m {[0m
[0m[31m[1m>[22m[39m[90m 67 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'No text generated from Gemini'[39m)[33m;[39m[0m
[0m [90m    |[39m             [31m[1m^[22m[39m[0m
[0m [90m 68 |[39m     }[0m
[0m [90m 69 |[39m   } [36mcatch[39m (error) {[0m
[0m [90m 70 |[39m     console[33m.[39merror([32m'Error calling Gemini directly:'[39m[33m,[39m error)[33m;[39m[0m
 POST / 500 in 24003ms
 âœ“ Compiled in 128ms (1474 modules)
Component rendered
 GET / 200 in 206ms
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /_not-found in 800ms (2237 modules)
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 884ms
 âœ“ Compiled /favicon.ico in 209ms (1507 modules)
 GET /favicon.ico 200 in 334ms
 GET /favicon.ico 200 in 16ms
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Initializing Gemini Service with config: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  model: 'gemini-2.5-flash',
  timeout: 60000
}
Vertex AI client initialized successfully
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
ðŸ” Debug tracking started for: generate-scenes
ðŸ“ Starting step: initialization
ðŸŽ¬ Generating scenes with enhanced Gemini service
ðŸŒ Environment Information:
  Project ID: fechen-aifactory
  Location: us-central1
  Gemini Model: gemini-2.5-flash
  Veo Model: veo-001
  Node Environment: development
  GCS Storage URI: NOT SET
  YouTube API Key: SET
âš ï¸ Environment warnings: [ 'GCS_VIDEOS_STORAGE_URI is not set - video generation may fail' ]
ðŸ“Š Configuration: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  geminiModel: 'gemini-2.5-flash',
  pitchLength: 493,
  numScenes: 8,
  style: '2D Animation',
  language: 'ç¹é«”ä¸­æ–‡'
}
âœ… Completed step: initialization (1ms)
ðŸ“ Starting step: health-check
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 1890ms with: HEALTHY
ðŸ¥ Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 1891
}
âœ… Completed step: health-check (1891ms)
ðŸ“ Starting step: gemini-text-generation
ðŸŽ¯ Creating storyboard with Gemini...
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 4832,
  temperature: 1,
  maxTokens: 8192,
  timeout: 60000
}
Attempt 1/3 with model: gemini-2.5-flash
 â¨¯ ./lib/youtube-transcript.ts
Error: 
  [31mx[0m 'import', and 'export' cannot be used outside of module code
     ,-[[36;1;4m/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/lib/youtube-transcript.ts[0m:353:1]
 [2m353[0m | /**
 [2m354[0m |  * Utility function to validate YouTube video accessibility
 [2m355[0m |  */
 [2m356[0m | export async function isYouTubeVideoAccessible(videoId: string, apiKey: string): Promise<boolean> {
     : [31;1m^^^^^^[0m
 [2m357[0m |   try {
 [2m358[0m |     const response = await fetch(
 [2m359[0m |       `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&key=${apiKey}&part=status`
     `----

Caused by:
    Syntax Error

Import trace for requested module:
./lib/youtube-transcript.ts
./app/actions/process-reference.ts
 âœ“ Compiled in 190ms (1507 modules)
Generated text successfully in 29245ms: {
  textLength: 10781,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "ä¸€å ´åŠ å·žæ·±å±±é‡Žç«è¿…é€Ÿè”“å»¶ï¼Œæ”å½±æ©Ÿå¾žç«è‹—è¿‘æ™¯æ‹‰é ï¼Œå±•ç¤ºç«ç„°åžå™¬æ£®æž—çš„é§­äººæ™¯è±¡ã€‚å‚³çµ±çš„æ‡‰è®ŠæŽªæ–½ç·©æ…¢å±•é–‹ï¼šæ¶ˆé˜²å±€æŽ¥åˆ°ç·Šæ€¥é€šçŸ¥ï¼Œèª¿åº¦äººåŠ›èˆ‡æ¶ˆé˜²è»Šè‰±é›£åœ°å¾žé æ–¹é§›å‘...'
}
âœ… Gemini response received: {
  textLength: 10781,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "ä¸€å ´åŠ å·žæ·±å±±é‡Žç«è¿…é€Ÿè”“å»¶ï¼Œæ”å½±æ©Ÿå¾žç«è‹—è¿‘æ™¯æ‹‰é ï¼Œå±•ç¤ºç«ç„°åžå™¬æ£®æž—çš„é§­äººæ™¯è±¡ã€‚å‚³çµ±çš„æ‡‰è®ŠæŽªæ–½ç·©æ…¢å±•é–‹ï¼šæ¶ˆé˜²å±€æŽ¥åˆ°ç·Šæ€¥é€šçŸ¥ï¼Œèª¿åº¦äººåŠ›èˆ‡æ¶ˆé˜²è»Šè‰±é›£åœ°å¾žé æ–¹é§›å‘ç«å ´ï¼Œè€Œç©ºæ‹é¡é ­å‰‡çªé¡¯äº†è·¯é€”é™é èˆ‡ç«å‹¢çš„å¤±æŽ§ã€‚å°±åœ¨å±æ©Ÿé”åˆ°é ‚é»žæ™‚ï¼Œç•«é¢åˆ‡æ›åˆ°ã€ŒAEGIS Autonomous Emergency Guardian Integrated Systemã€çš„å­—æ¨£ã€‚éš¨å¾Œï¼Œ...'
}
âœ… Completed step: gemini-text-generation (29247ms)
ðŸ“ Starting step: response-parsing
Cleaning JSON response, original length: 10781
Cleaned JSON length: 10757
JSON structure check - braces balanced: true
Failed to parse AI response, raw text: ```json
{
 "scenario": "ä¸€å ´åŠ å·žæ·±å±±é‡Žç«è¿…é€Ÿè”“å»¶ï¼Œæ”å½±æ©Ÿå¾žç«è‹—è¿‘æ™¯æ‹‰é ï¼Œå±•ç¤ºç«ç„°åžå™¬æ£®æž—çš„é§­äººæ™¯è±¡ã€‚å‚³çµ±çš„æ‡‰è®ŠæŽªæ–½ç·©æ…¢å±•é–‹ï¼šæ¶ˆé˜²å±€æŽ¥åˆ°ç·Šæ€¥é€šçŸ¥ï¼Œèª¿åº¦äººåŠ›èˆ‡æ¶ˆé˜²è»Šè‰±é›£åœ°å¾žé æ–¹é§›å‘ç«å ´ï¼Œè€Œç©ºæ‹é¡é ­å‰‡çªé¡¯äº†è·¯é€”é™é èˆ‡ç«å‹¢çš„å¤±æŽ§ã€‚å°±åœ¨å±æ©Ÿé”åˆ°é ‚é»žæ™‚ï¼Œç•«é¢åˆ‡æ›åˆ°ã€ŒAEGIS Autonomous Emergency Guardian Integrated Systemã€çš„å­—æ¨£ã€‚éš¨å¾Œï¼ŒAEGISç³»çµ±å•Ÿå‹•ï¼Œéå¸ƒæ·±å±±çš„æ„Ÿæ¸¬å™¨é–ƒçˆç´…å…‰ï¼Œç²¾æº–åµæ¸¬ç«å ´çš„æº«åº¦ã€é¢¨å‘èˆ‡é¢¨å‹¢ï¼Œä¸¦ç™¼å‡ºå³æ™‚é è­¦ã€‚ç·ŠæŽ¥è‘—ï¼Œæ•¸åæž¶AEGISç„¡äººæ©Ÿçµ„æˆçš„é¾å¤§æ©ŸéšŠä»¥é©šäººçš„é€Ÿåº¦è¡å‘ç«å ´ï¼Œé è¶…åœ°é¢æ¶ˆé˜²è»Šçš„é€Ÿåº¦ã€‚ç¬¬ä¸€æ‰¹ç„¡äººæ©Ÿç²¾æº–æŠµé”ç«å‹¢æœ€çŒ›çƒˆçš„å€åŸŸï¼Œåœ¨é å®šé–“éš”å¼•çˆ†ç‰¹è£½æ»…ç«å½ˆï¼Œçž¬é–“å£“åˆ¶ç«å‹¢ã€‚ç·Šéš¨å…¶å¾Œï¼Œç¬¬äºŒæ‰¹ç„¡äººæ©Ÿæ”œå¸¶å¤§é‡è“„æ°´æŠµé”ï¼Œå°æ®˜é¤˜ç«é»žé€²è¡Œç²¾æº–æ’²æ»…ï¼Œé˜²æ­¢ç«å‹¢å¾©ç‡ƒã€‚æœ€çµ‚ï¼Œç•«é¢é¡¯ç¤ºã€ŒDetected in Seconds. Extinguished with Precision.ã€ï¼Œä¸¦ä»¥é»‘åº•ç™½å­—çš„ã€ŒAEGISã€æ¨™èªŒå®Œç¾Žæ”¶å°¾ã€‚",
 "genre": "Cinematic",
 "mood": "Inspirational",
ðŸš¨ Error in response-parsing: Parse error: There was an issue processing the AI response.
Error parsing AI response: Error: Response Processing Error: There was an issue processing the AI response. Please try again.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:225:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
âŒ Completed step: response-parsing (8ms) - Response Processing Error: There was an issue processing the AI response. Please try again.
ðŸš¨ Error in response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
âŒ Error generating scenes: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
ðŸš¨ Error in generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
ðŸ”„ Unexpected error, creating fallback scenario: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
ðŸ”„ Creating fallback scenario due to unexpected error
ðŸ“ Starting step: fallback-scenario
Creating fallback scenario for pitch: ç¬¬1å¹•
æ”å½±æ©Ÿå¾žè¿‘è™•æ‹æ”æ£®æž—ä¸­é–‹å§‹èµ·ç«ï¼Œç„¶å¾Œé‹é¡é€æ¼¸æ‹‰é åˆ°ç„¡äººæ©Ÿç©ºæ‹çš„é¡é ­
é¡¯ç¤ºæ£®æž—æ­£åœ¨èµ·ç«ï¼Œåœ°é»žå°±åœ¨åŠ å·ž

ç¬¬2å¹•
é¡¯ç¤ºå‚³çµ±ç¾åœ¨çš„æ•‘ç«æ–¹å¼ï¼Œæ˜¯é€éŽå‘¼å«é€šçŸ¥çµ¦é åœ¨åŠ å·žçš„æ¶ˆé˜²å±€ï¼Œåœ¨ç·Šæ€¥èª¿æ´¾äººåŠ›ã€æ¶ˆé˜²è»Šå¾€
âœ… Completed step: fallback-scenario (0ms)
ðŸ” Debug summary for generate-scenes: {
  totalTime: '31155ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

ðŸ“Š === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 31155ms
Environment: fechen-aifactory/us-central1/gemini-2.5-flash

âŒ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

â±ï¸ Step Performance:
  âœ… initialization: 1ms
  âœ… health-check: 1891ms
  âœ… gemini-text-generation: 29247ms
  âŒ response-parsing: 8ms
  âœ… fallback-scenario: 0ms
ðŸ“Š === END SUMMARY ===

ðŸ” Debug summary for generate-scenes: {
  totalTime: '31156ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

ðŸ“Š === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 31156ms
Environment: fechen-aifactory/us-central1/gemini-2.5-flash

âŒ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

â±ï¸ Step Performance:
  âœ… initialization: 1ms
  âœ… health-check: 1891ms
  âœ… gemini-text-generation: 29247ms
  âŒ response-parsing: 8ms
  âœ… fallback-scenario: 0ms
ðŸ“Š === END SUMMARY ===

 POST / 200 in 31258ms
