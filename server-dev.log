
> storycraft@0.1.0 dev
> next dev

  ▲ Next.js 14.2.31
  - Local:        http://localhost:3000
  - Environments: .env

 ✓ Starting...
 ✓ Ready in 4.3s
 ○ Compiling / ...
 ✓ Compiled / in 3.2s (2257 modules)
Component rendered
 GET / 200 in 3654ms
 ○ Compiling /_not-found ...
 ✓ Compiled /favicon.ico in 1520ms (2269 modules)
 GET /favicon.ico 200 in 737ms
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 1334ms
 GET /favicon.ico 200 in 21ms
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Initializing Gemini Service with config: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  model: 'gemini-2.5-flash',
  timeout: 60000
}
Vertex AI client initialized successfully
Attempting transcript extraction for video: snyvim1b4aw
Checking transcript availability for video: snyvim1b4aw
Found 1 caption track(s) available
Best caption track: zh-TW (standard)
Attempting caption download (likely to fail due to OAuth requirement)
Caption download requires OAuth 2.0 authentication (expected failure)
Caption content download failed (OAuth required) - this is expected behavior
No usable transcript content available for this video
Transcript not available, extracting enhanced metadata...
Extracting enhanced metadata for video: snyvim1b4aw
Enhanced metadata extraction failed: TypeError: fetch failed
    at node:internal/deps/undici/undici:13510:13
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async extractVideoInsightsFromMetadata (webpack-internal:///(action-browser)/./lib/youtube-transcript.ts:192:26)
    at async _lib_performance_monitor__WEBPACK_IMPORTED_MODULE_5__.performanceMonitor.trackOperation.url.url (webpack-internal:///(action-browser)/./app/actions/process-reference.ts:95:38)
    at async PerformanceMonitor.trackOperation (webpack-internal:///(action-browser)/./lib/performance-monitor.ts:22:28)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) {
  [cause]: Error: read ECONNRESET
      at TLSWrap.onStreamRead (node:internal/stream_base_commons:218:20)
      at TLSWrap.callbackTrampoline (node:internal/async_hooks:130:17) {
    errno: -54,
    code: 'ECONNRESET',
    syscall: 'read'
  }
}
 POST / 200 in 667ms
Processing reference content with enhanced Gemini service
Source type: youtube
Has transcript: false
Description length: 433
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 1784ms with: HEALTHY
Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 1785
}
Using enhanced description content
Content Complexity Analysis: {
  contentType: 'youtube_medium',
  isShorts: false,
  shortsStyle: undefined,
  topicsComplexity: 'simple',
  tokenAllocation: 3500,
  reasoning: 'Medium YouTube video (60-300s) + No complexity adjustments = 3500 tokens',
  useStructuredOutput: undefined
}
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 3251,
  temperature: 0.3,
  maxTokens: 3500,
  timeout: 60000
}
Attempt 1/3 with model: gemini-2.5-flash
Generated text successfully in 18866ms: {
  textLength: 2265,
  textPreview: '{\n' +
    '  "analysis": {\n' +
    '    "keyTopics": [\n' +
    '      "歧路旅人2",\n' +
    '      "快速升級攻略",\n' +
    '      "後期遊戲策略",\n' +
    '      "角色扮演遊戲機制"...'
}
🔧 Starting enhanced JSON parsing for AI response
Raw AI response length: 2265
First 200 chars: {
  "analysis": {
    "keyTopics": [
      "歧路旅人2",
      "快速升級攻略",
      "後期遊戲策略",
      "角色扮演遊戲機制",
      "HD-2D視覺風格"
    ],
    "sentiment": "positive",
    "coreMessage": "提供《歧路旅人2》玩家一套高效的後期升級策略，幫
✅ Enhanced JSON parsing successful!
Repair attempts: 2
Parse time: 3ms
Content processing completed in 20670ms
 POST / 200 in 20691ms
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
🔍 Debug tracking started for: generate-scenes
📍 Starting step: initialization
🎬 Generating scenes with enhanced Gemini service
🌍 Environment Information:
  Project ID: fechen-aifactory
  Location: us-central1
  Gemini Model: NOT SET
  Veo Model: veo-001
  Node Environment: development
  GCS Storage URI: NOT SET
  YouTube API Key: SET
⚠️ Environment warnings: [
  'GEMINI_MODEL is not set - will use default gemini-1.5-pro-002',
  'GCS_VIDEOS_STORAGE_URI is not set - video generation may fail'
]
📊 Configuration: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  geminiModel: 'gemini-pro',
  pitchLength: 1667,
  numScenes: 8,
  style: 'Live-Action',
  language: '繁體中文'
}
✅ Completed step: initialization (0ms)
📍 Starting step: health-check
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 1520ms with: HEALTHY
🏥 Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 1521
}
✅ Completed step: health-check (1521ms)
📍 Starting step: gemini-text-generation
🎯 Creating storyboard with Gemini...
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 6005,
  temperature: 1,
  maxTokens: 8192,
  timeout: 60000
}
Attempt 1/3 with model: gemini-2.5-flash
Generated text successfully in 27003ms: {
  textLength: 9352,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "【影片標題：人生LV.99：你的專屬「艾隆德」升級法】\\n\\n**開場：**\\n影片從一個壓抑的書房開始。畫面特寫一位年輕、疲憊的女性，她眉頭緊鎖，眼神...'
}
✅ Gemini response received: {
  textLength: 9352,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "【影片標題：人生LV.99：你的專屬「艾隆德」升級法】\\n\\n**開場：**\\n影片從一個壓抑的書房開始。畫面特寫一位年輕、疲憊的女性，她眉頭緊鎖，眼神中充滿了挫敗感。鏡頭緩緩拉遠，呈現出一個雜亂不堪的書桌，上面堆滿了專業書籍、散亂的文件和未完成的專案。光線昏暗，只有一盞檯燈微弱地照亮桌面，營造出停滯不前的氛圍。窗外，陰沉的天空下著小雨，雨滴輕輕敲打...'
}
✅ Completed step: gemini-text-generation (27005ms)
📍 Starting step: response-parsing
Cleaning JSON response, original length: 9352
Cleaned JSON length: 9322
JSON structure check - braces balanced: true
Failed to parse AI response, raw text: ```json
{
 "scenario": "【影片標題：人生LV.99：你的專屬「艾隆德」升級法】\n\n**開場：**\n影片從一個壓抑的書房開始。畫面特寫一位年輕、疲憊的女性，她眉頭緊鎖，眼神中充滿了挫敗感。鏡頭緩緩拉遠，呈現出一個雜亂不堪的書桌，上面堆滿了專業書籍、散亂的文件和未完成的專案。光線昏暗，只有一盞檯燈微弱地照亮桌面，營造出停滯不前的氛圍。窗外，陰沉的天空下著小雨，雨滴輕輕敲打著玻璃。\n畫外音傳來一聲沉重的嘆息：「怎麼努力，都感覺停滯不前…」\n\n**角色介紹：**\n主角是一位約莫二十多歲的女性，聰慧但目前深陷困境。她並非在玩遊戲，而是在現實生活中面臨著巨大的「關卡」——可能是學業研究的瓶頸、職場專案的挑戰，或是個人成長的迷茫。她渴望突破，達到自己人生的「LV.99」，但卻始終找不到正確的方法，感到心力交瘁。\n\n**第一幕：困境與迷茫 (開端)**\n書房裡，年輕女性雙手抱頭，坐在書桌前。電腦螢幕上顯示著複雜難解的數據模型或學術論文，她顯然已陷入僵局。她拿起筆又無力地放下，桌面上散落著無數失敗的草稿，象徵著她無助的掙扎。昏暗雜亂的房間映照出她內心的混亂與停
🚨 Error in response-parsing: Parse error: There was an issue processing the AI response.
Error parsing AI response: Error: Response Processing Error: There was an issue processing the AI response. Please try again.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:225:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
❌ Completed step: response-parsing (12ms) - Response Processing Error: There was an issue processing the AI response. Please try again.
🚨 Error in response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
❌ Error generating scenes: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
🚨 Error in generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
🔄 Unexpected error, creating fallback scenario: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
🔄 Creating fallback scenario due to unexpected error
📍 Starting step: fallback-scenario
Creating fallback scenario for pitch: 【影片標題：人生LV.99：你的專屬「艾隆德」升級法】
**開場鉤子：**\n畫面從一個特寫鏡頭開始：一張年輕、疲憊的臉龐，眉頭深鎖，眼神中充滿了挫敗感。鏡頭緩緩拉遠，呈現出一個略顯雜亂的書房，書桌上
✅ Completed step: fallback-scenario (1ms)
🔍 Debug summary for generate-scenes: {
  totalTime: '28547ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

📊 === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 28547ms
Environment: fechen-aifactory/us-central1/not-set

❌ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

⏱️ Step Performance:
  ✅ initialization: 0ms
  ✅ health-check: 1521ms
  ✅ gemini-text-generation: 27005ms
  ❌ response-parsing: 12ms
  ✅ fallback-scenario: 1ms
📊 === END SUMMARY ===

🔍 Debug summary for generate-scenes: {
  totalTime: '28548ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

📊 === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 28548ms
Environment: fechen-aifactory/us-central1/not-set

❌ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

⏱️ Step Performance:
  ✅ initialization: 0ms
  ✅ health-check: 1521ms
  ✅ gemini-text-generation: 27005ms
  ❌ response-parsing: 12ms
  ✅ fallback-scenario: 1ms
📊 === END SUMMARY ===

 POST / 200 in 28572ms
Attempting transcript extraction for video: Y7a_ooX7gOM
Checking transcript availability for video: Y7a_ooX7gOM
No captions available for this video
No usable transcript content available for this video
Transcript not available, extracting enhanced metadata...
Extracting enhanced metadata for video: Y7a_ooX7gOM
Enhanced metadata extracted successfully
 POST / 200 in 699ms
Processing reference content with enhanced Gemini service
Source type: youtube
Has transcript: false
Description length: 936
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 719ms with: HEALTHY
Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 719
}
Using enhanced description content
Content Complexity Analysis: {
  contentType: 'youtube_long_form',
  isShorts: false,
  shortsStyle: undefined,
  topicsComplexity: 'moderate',
  tokenAllocation: 5009,
  reasoning: 'Long-form YouTube video (11min) + +500 (moderate complexity) +9 (detailed description) = 5009 tokens',
  useStructuredOutput: undefined
}
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 3692,
  temperature: 0.3,
  maxTokens: 5009,
  timeout: 90000
}
Attempt 1/3 with model: gemini-2.5-flash
Generated text successfully in 23699ms: {
  textLength: 1529,
  textPreview: '{\n' +
    '  "analysis": {\n' +
    '    "keyTopics": [\n' +
    '      "《真‧三國無雙》25週年慶祝",\n' +
    '      "《真‧三國無雙 起源》大型DLC",\n' +
    '      "過往系列作品...'
}
🔧 Starting enhanced JSON parsing for AI response
Raw AI response length: 1529
First 200 chars: {
  "analysis": {
    "keyTopics": [
      "《真‧三國無雙》25週年慶祝",
      "《真‧三國無雙 起源》大型DLC",
      "過往系列作品高畫質復刻",
      "資深玩家視角分析與回顧",
      "光榮未來動向與玩家期待"
    ],
    "sentiment": "positive",
    "coreMessag
❌ All enhanced parsing strategies failed
Parse errors: [
  'Direct parsing failed: Unterminated string in JSON at position 1529',
  'Basic cleaning schema error: generatedPitch must be a non-empty string'
]
Creating intelligent fallback response...
Content processing completed in 24430ms
 POST / 200 in 24444ms
🎬 Generating scenes from structured pitch
Environment Information:
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: undefined
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Refreshing authentication...
Fetching new access token...
Successfully obtained access token
Gemini API Error: {
  error: {
    code: 400,
    message: 'Please use a valid role: user, model.',
    status: 'INVALID_ARGUMENT'
  }
}
Error calling Gemini directly: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
Error in structured output generation: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
🔴 ERROR: Error generating structured scenes Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) undefined
 POST / 500 in 648ms
 ⨯ lib/gemini-direct.ts (58:13) @ generateTextDirect
 ⨯ Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (./lib/gemini-direct.ts:47:19)
    at async StructuredOutputService.generateCharacters (./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (./app/actions/generate-scenes-structured.ts:33:31)
digest: "2804120234"
[0m [90m 56 |[39m       [36mconst[39m error [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
[0m [90m 57 |[39m       console[33m.[39merror([32m'Gemini API Error:'[39m[33m,[39m error)[33m;[39m[0m
[0m[31m[1m>[22m[39m[90m 58 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Gemini API failed: ${JSON.stringify(error)}`[39m)[33m;[39m[0m
[0m [90m    |[39m             [31m[1m^[22m[39m[0m
[0m [90m 59 |[39m     }[0m
[0m [90m 60 |[39m[0m
[0m [90m 61 |[39m     [36mconst[39m result[33m:[39m [33mGeminiResponse[39m [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
🎬 Generating scenes from structured pitch
Environment Information:
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: undefined
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-pro
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Using cached access token
Gemini API Error: {
  error: {
    code: 400,
    message: 'Please use a valid role: user, model.',
    status: 'INVALID_ARGUMENT'
  }
}
Error calling Gemini directly: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
Error in structured output generation: Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
🔴 ERROR: Error generating structured scenes Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:47:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateCharacters (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) undefined
 ⨯ lib/gemini-direct.ts (58:13) @ generateTextDirect
 ⨯ Error: Gemini API failed: {"error":{"code":400,"message":"Please use a valid role: user, model.","status":"INVALID_ARGUMENT"}}
    at generateTextDirect (./lib/gemini-direct.ts:47:19)
    at async StructuredOutputService.generateCharacters (./lib/structured-output-service.ts:55:26)
    at async StructuredOutputService.generateStructuredPitch (./lib/structured-output-service.ts:12:32)
    at async generateScenesStructured (./app/actions/generate-scenes-structured.ts:33:31)
digest: "2804120234"
[0m [90m 56 |[39m       [36mconst[39m error [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
[0m [90m 57 |[39m       console[33m.[39merror([32m'Gemini API Error:'[39m[33m,[39m error)[33m;[39m[0m
[0m[31m[1m>[22m[39m[90m 58 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Gemini API failed: ${JSON.stringify(error)}`[39m)[33m;[39m[0m
[0m [90m    |[39m             [31m[1m^[22m[39m[0m
[0m [90m 59 |[39m     }[0m
[0m [90m 60 |[39m[0m
[0m [90m 61 |[39m     [36mconst[39m result[33m:[39m [33mGeminiResponse[39m [33m=[39m [36mawait[39m response[33m.[39mjson()[33m;[39m[0m
 POST / 500 in 371ms
 ✓ Compiled in 508ms (1474 modules)
 ✓ Compiled in 460ms (2234 modules)
   Reload env: .env
 ✓ Compiled in 137ms (2234 modules)
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
🎬 Generating scenes from structured pitch
Environment Information:
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: undefined
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Refreshing authentication...
Fetching new access token...
Successfully obtained access token
 ✓ Compiled in 171ms (2234 modules)
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Using cached access token
Error calling Gemini directly: Error: No text generated from Gemini
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:54:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateScenes (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
Error in structured output generation: Error: No text generated from Gemini
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:54:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateScenes (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
🔴 ERROR: Error generating structured scenes Error: No text generated from Gemini
    at generateTextDirect (webpack-internal:///(action-browser)/./lib/gemini-direct.ts:54:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async StructuredOutputService.generateScenes (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (webpack-internal:///(action-browser)/./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (webpack-internal:///(action-browser)/./app/actions/generate-scenes-structured.ts:33:31)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13) undefined
 ⨯ lib/gemini-direct.ts (67:13) @ generateTextDirect
 ⨯ Error: No text generated from Gemini
    at generateTextDirect (./lib/gemini-direct.ts:54:19)
    at async StructuredOutputService.generateScenes (./lib/structured-output-service.ts:111:26)
    at async StructuredOutputService.generateStructuredPitch (./lib/structured-output-service.ts:14:28)
    at async generateScenesStructured (./app/actions/generate-scenes-structured.ts:33:31)
digest: "406129011"
[0m [90m 65 |[39m       [36mreturn[39m result[33m.[39mcandidates[[35m0[39m][33m.[39mcontent[33m.[39mparts[[35m0[39m][33m.[39mtext[33m;[39m[0m
[0m [90m 66 |[39m     } [36melse[39m {[0m
[0m[31m[1m>[22m[39m[90m 67 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'No text generated from Gemini'[39m)[33m;[39m[0m
[0m [90m    |[39m             [31m[1m^[22m[39m[0m
[0m [90m 68 |[39m     }[0m
[0m [90m 69 |[39m   } [36mcatch[39m (error) {[0m
[0m [90m 70 |[39m     console[33m.[39merror([32m'Error calling Gemini directly:'[39m[33m,[39m error)[33m;[39m[0m
 POST / 500 in 24003ms
 ✓ Compiled in 128ms (1474 modules)
Component rendered
 GET / 200 in 206ms
 ○ Compiling /_not-found ...
 ✓ Compiled /_not-found in 800ms (2237 modules)
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 884ms
 ✓ Compiled /favicon.ico in 209ms (1507 modules)
 GET /favicon.ico 200 in 334ms
 GET /favicon.ico 200 in 16ms
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
Initializing Gemini Service with config: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  model: 'gemini-2.5-flash',
  timeout: 60000
}
Vertex AI client initialized successfully
Vertex AI Configuration:
  Project ID: fechen-aifactory
  Location: us-central1
  Veo Model: veo-001
  Gemini Model: gemini-2.5-flash
  GCS Videos Storage URI: Not set
  YouTube API Key: Set
🔍 Debug tracking started for: generate-scenes
📍 Starting step: initialization
🎬 Generating scenes with enhanced Gemini service
🌍 Environment Information:
  Project ID: fechen-aifactory
  Location: us-central1
  Gemini Model: gemini-2.5-flash
  Veo Model: veo-001
  Node Environment: development
  GCS Storage URI: NOT SET
  YouTube API Key: SET
⚠️ Environment warnings: [ 'GCS_VIDEOS_STORAGE_URI is not set - video generation may fail' ]
📊 Configuration: {
  projectId: 'fechen-aifactory',
  location: 'us-central1',
  geminiModel: 'gemini-2.5-flash',
  pitchLength: 493,
  numScenes: 8,
  style: '2D Animation',
  language: '繁體中文'
}
✅ Completed step: initialization (1ms)
📍 Starting step: health-check
Testing model availability: gemini-2.5-flash
Model gemini-2.5-flash responded in 1890ms with: HEALTHY
🏥 Gemini Health Check: {
  healthy: true,
  model: 'gemini-2.5-flash',
  region: 'us-central1',
  responseTime: 1891
}
✅ Completed step: health-check (1891ms)
📍 Starting step: gemini-text-generation
🎯 Creating storyboard with Gemini...
Generating text with Gemini: {
  model: 'gemini-2.5-flash',
  promptLength: 4832,
  temperature: 1,
  maxTokens: 8192,
  timeout: 60000
}
Attempt 1/3 with model: gemini-2.5-flash
 ⨯ ./lib/youtube-transcript.ts
Error: 
  [31mx[0m 'import', and 'export' cannot be used outside of module code
     ,-[[36;1;4m/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/lib/youtube-transcript.ts[0m:353:1]
 [2m353[0m | /**
 [2m354[0m |  * Utility function to validate YouTube video accessibility
 [2m355[0m |  */
 [2m356[0m | export async function isYouTubeVideoAccessible(videoId: string, apiKey: string): Promise<boolean> {
     : [31;1m^^^^^^[0m
 [2m357[0m |   try {
 [2m358[0m |     const response = await fetch(
 [2m359[0m |       `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&key=${apiKey}&part=status`
     `----

Caused by:
    Syntax Error

Import trace for requested module:
./lib/youtube-transcript.ts
./app/actions/process-reference.ts
 ✓ Compiled in 190ms (1507 modules)
Generated text successfully in 29245ms: {
  textLength: 10781,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "一場加州深山野火迅速蔓延，攝影機從火苗近景拉遠，展示火焰吞噬森林的駭人景象。傳統的應變措施緩慢展開：消防局接到緊急通知，調度人力與消防車艱難地從遠方駛向...'
}
✅ Gemini response received: {
  textLength: 10781,
  textPreview: '```json\n' +
    '{\n' +
    ' "scenario": "一場加州深山野火迅速蔓延，攝影機從火苗近景拉遠，展示火焰吞噬森林的駭人景象。傳統的應變措施緩慢展開：消防局接到緊急通知，調度人力與消防車艱難地從遠方駛向火場，而空拍鏡頭則突顯了路途遙遠與火勢的失控。就在危機達到頂點時，畫面切換到「AEGIS Autonomous Emergency Guardian Integrated System」的字樣。隨後，...'
}
✅ Completed step: gemini-text-generation (29247ms)
📍 Starting step: response-parsing
Cleaning JSON response, original length: 10781
Cleaned JSON length: 10757
JSON structure check - braces balanced: true
Failed to parse AI response, raw text: ```json
{
 "scenario": "一場加州深山野火迅速蔓延，攝影機從火苗近景拉遠，展示火焰吞噬森林的駭人景象。傳統的應變措施緩慢展開：消防局接到緊急通知，調度人力與消防車艱難地從遠方駛向火場，而空拍鏡頭則突顯了路途遙遠與火勢的失控。就在危機達到頂點時，畫面切換到「AEGIS Autonomous Emergency Guardian Integrated System」的字樣。隨後，AEGIS系統啟動，遍布深山的感測器閃爍紅光，精準偵測火場的溫度、風向與風勢，並發出即時預警。緊接著，數十架AEGIS無人機組成的龐大機隊以驚人的速度衝向火場，遠超地面消防車的速度。第一批無人機精準抵達火勢最猛烈的區域，在預定間隔引爆特製滅火彈，瞬間壓制火勢。緊隨其後，第二批無人機攜帶大量蓄水抵達，對殘餘火點進行精準撲滅，防止火勢復燃。最終，畫面顯示「Detected in Seconds. Extinguished with Precision.」，並以黑底白字的「AEGIS」標誌完美收尾。",
 "genre": "Cinematic",
 "mood": "Inspirational",
🚨 Error in response-parsing: Parse error: There was an issue processing the AI response.
Error parsing AI response: Error: Response Processing Error: There was an issue processing the AI response. Please try again.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:225:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
❌ Completed step: response-parsing (8ms) - Response Processing Error: There was an issue processing the AI response. Please try again.
🚨 Error in response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
❌ Error generating scenes: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
🚨 Error in generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
🔄 Unexpected error, creating fallback scenario: Error: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.
    at generateScenes (webpack-internal:///(action-browser)/./app/actions/generate-scenes.ts:253:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:39:418
    at async rk (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:38:8146)
    at async r3 (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/compiled/next-server/app-page.runtime.dev.js:41:1256)
    at async doRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1427:30)
    at async cacheEntry.responseCache.get.routeKind (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1588:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1496:28)
    at async DevServer.renderPageComponent (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1924:24)
    at async DevServer.renderToResponseImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:1962:32)
    at async DevServer.pipeImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:922:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/base-server.js:818:17)
    at async /Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:179:21)
    at async handleRequest (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:359:24)
    at async requestHandlerImpl (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/router-server.js:383:13)
    at async Server.requestListener (/Users/shouian99/Desktop/macmbp/saas_app/storycraft-main/node_modules/next/dist/server/lib/start-server.js:141:13)
🔄 Creating fallback scenario due to unexpected error
📍 Starting step: fallback-scenario
Creating fallback scenario for pitch: 第1幕
攝影機從近處拍攝森林中開始起火，然後運鏡逐漸拉遠到無人機空拍的鏡頭
顯示森林正在起火，地點就在加州

第2幕
顯示傳統現在的救火方式，是透過呼叫通知給遠在加州的消防局，在緊急調派人力、消防車往
✅ Completed step: fallback-scenario (0ms)
🔍 Debug summary for generate-scenes: {
  totalTime: '31155ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

📊 === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 31155ms
Environment: fechen-aifactory/us-central1/gemini-2.5-flash

❌ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

⏱️ Step Performance:
  ✅ initialization: 1ms
  ✅ health-check: 1891ms
  ✅ gemini-text-generation: 29247ms
  ❌ response-parsing: 8ms
  ✅ fallback-scenario: 0ms
📊 === END SUMMARY ===

🔍 Debug summary for generate-scenes: {
  totalTime: '31156ms',
  stepsCompleted: 5,
  errorsEncountered: 3,
  successRate: '80%'
}

📊 === DEBUG SUMMARY ===
Operation: generate-scenes
Total Time: 31156ms
Environment: fechen-aifactory/us-central1/gemini-2.5-flash

❌ Errors encountered:
  1. response-parsing: Parse error: There was an issue processing the AI response.
  2. response-parsing: Response Processing Error: There was an issue processing the AI response. Please try again.
  3. generate-scenes: Unexpected Error: Something went wrong while processing your content. Please try again or contact support if the issue persists.

⏱️ Step Performance:
  ✅ initialization: 1ms
  ✅ health-check: 1891ms
  ✅ gemini-text-generation: 29247ms
  ❌ response-parsing: 8ms
  ✅ fallback-scenario: 0ms
📊 === END SUMMARY ===

 POST / 200 in 31258ms
